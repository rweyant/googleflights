{
    "contents" : "suppressPackageStartupMessages(library(httr))\nsuppressPackageStartupMessages(library(jsonlite))\nsuppressPackageStartupMessages(library(XML))\nsuppressPackageStartupMessages(library(dplyr))\nsuppressPackageStartupMessages(library(stringr))\n\n#' set Google API key for future functions\n#' @param key your API key\nset_apikey <- function(key) options('googleflightskey'=key)\n\n#' Search QPX for flights\n#' @param origin Departing Airport Code\n#' @param dest Destination Airport Code\n#' @param startDate Departure date (yyyy-mm-dd)\n#' @param startDate Return date (yyyy-mm-dd)\n#' @param numPassengers Number of people traveling\nsearch <- function(origin,dest,startDate,returnDate,numPassengers=1,...){\n\n  base_url <- paste('https://www.googleapis.com/qpxExpress/v1/trips/search?key=',\n                    getOption('googleflightskey'),sep='')\n\n  # Build query\n  query <- list(\n    request=list(\n      passengers=list(adultCount=numPassengers),\n      slice=data.frame(origin=c(origin,dest),destination=c(dest,origin),date=c(startDate,returnDate)))\n    )\n\n  # make Request\n  request <- POST(url = base_url,body=query,encode='json')\n\n  # Check if query was successful\n  if(status_code(request) != 200) stop('Error with request...')\n\n  return(content(request))\n}\n\nsummarize_segments <- function(trip){\n\n  startFlight <- trip$slice[[1]]\n  returnFlight <- trip$slice[[2]]\n\n  price <- trip$saleTotal %>% gsub('USD','',.) %>% as.numeric\n\n  startOrig <- sapply(startFlight$segment, function(x) x$leg[[1]]$origin)\n  startDest <- sapply(startFlight$segment, function(x) x$leg[[1]]$destination)\n\n  returnOrig <- sapply(returnFlight$segment, function(x) x$leg[[1]]$origin)\n  returnDest <- sapply(returnFlight$segment, function(x) x$leg[[1]]$destination)\n\n  departing_flights <- sapply(startFlight$segment,function(x) x$flight %>% unlist %>% paste(collapse='-'))\n  returning_flights <- sapply(returnFlight$segment,function(x) x$flight %>% unlist %>% paste(collapse='-'))\n\n  departing_carriers <- sapply(startFlight$segment,function(x) x$flight$carrier)\n  returning_carriers <- sapply(returnFlight$segment,function(x) x$flight$carrier)\n\n  # test <- startFlight$segment[[1]]\n\n  cbind.data.frame(price,\n                   departing_stops=length(startOrig)-1,\n                   returning_stops=length(returnOrig)-1,\n                   departing_locations=startOrig,\n                   returning_locations=returnOrig,\n                   departing_flights=departing_flights,\n                   returning_flights=returning_flights,\n                   departing_carriers=departing_carriers,\n                   returning_carriers=returning_carriers,\n                   stringsAsFactors=FALSE)\n\n}\n\nsimplify_ <- function(content){\n\n  # Each trip\n  trips <- content$trips$tripOption\n  # Extract information from each trip.\n  summary <-\n    sapply(trips,summarize_trip) %>% t\n  }\n\nnothing <- function(){\n  names(content$trips)\n  length(content$trips)\n  names(content$trips)\n  content$trips$data$airport[1]\n  tmp <- content$trips$tripOption[1]\n  tmp2 <- tmp[[1]]\n  tmp2$saleTotal\n  tmp3 <- tmp2$slice\n  tmp4 <- tmp3[[1]]\n  tmp4$duration\n\n  content$trips$tripOption\n  content$trips$tripOption[[1]]$saleTotal\n  salePrice <- sapply(content$trips$tripOption,function(x) gsub('USD','',x$saleTotal))\n  routeBeg <- sapply(content$trips$tripOption[[1]]$slice[[1]]$segment, function(x) x$leg[[1]]$origin)\n  routeEnd <- sapply(content$trips$tripOption[[1]]$slice[[1]]$segment, function(x) x$leg[[1]]$destination)\n  individualFlights <-\n    paste(sapply(content$trips$tripOption[[1]]$slice[[1]]$segment,function(x) x$flight %>% unlist %>% paste(collapse='-')),collapse=' -> ')\n  paste(sapply(content$trips$tripOption[[1]]$slice[[2]]$segment,function(x) x$flight %>% unlist %>% paste(collapse='-')),collapse=' -> ')\n  content$trips$tripOption[[1]]$slice %>% length\n\n}\n",
    "created" : 1442158517767.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1779405640",
    "id" : "451DE90A",
    "lastKnownWriteTime" : 1442231326,
    "path" : "/media/roberto/Main Storage/Documents/R/packages/googleflights/R/api.R",
    "project_path" : "R/api.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}